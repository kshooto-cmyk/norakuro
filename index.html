<script>
// 商品データと注文リストの管理
let products = [];
let orderList = JSON.parse(localStorage.getItem('orderList')) || [];

// 商品データ（サンプル）を即時に設定
const sampleProducts = [
    // サンプル商品データ（元のコードと同じ）
];

// DOMの読み込み完了時に実行
document.addEventListener('DOMContentLoaded', function() {
    // ローカルストレージから注文リストを読み込み
    orderList = JSON.parse(localStorage.getItem('orderList')) || [];
    updateOrderListButton();
    
    // 商品データの取得を試みる
    fetch('products.json')
        .then(response => {
            if (!response.ok) {
                throw new Error(`HTTP error! Status: ${response.status}`);
            }
            return response.json();
        })
        .then(data => {
            products = data;
            displayProducts(products);
        })
        .catch(error => {
            console.error('商品データの取得中にエラーが発生しました:', error);
            // エラー時はサンプル商品を表示
            products = sampleProducts;
            displayProducts(products);
        });
});

// 注文リストへの追加関数を修正
function addToOrderList(productId) {
    const quantity = parseInt(document.getElementById(`quantity-${productId}`).textContent);
    const product = products.find(p => p.id === productId);
    
    if (!product) {
        console.error('商品が見つかりません:', productId);
        alert('商品情報の読み込みに問題があります。ページを再読み込みしてください。');
        return;
    }
    
    const existingItem = orderList.find(item => item.id === productId);
    
    if (existingItem) {
        existingItem.quantity += quantity;
    } else {
        orderList.push({
            id: product.id,
            name: product.name,
            price: product.discountRate > 0 ? calculateDiscountPrice(product) : product.price,
            quantity: quantity,
            image: product.imageURL
        });
    }
    
    // ローカルストレージに保存
    localStorage.setItem('orderList', JSON.stringify(orderList));
    updateOrderListButton();
    alert('注文リストに追加しました');
    
    // 数量をリセット
    document.getElementById(`quantity-${productId}`).textContent = '1';
    
    // 注文リストページが表示中の場合は更新
    if (document.getElementById('order-page').classList.contains('active')) {
        displayOrderList();
        calculateTotal();
    }
}

// その他の関数は変更なし
</script>